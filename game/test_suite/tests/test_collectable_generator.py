import unittest

from game.quarry_rush.map.collectable.collectable_generator import CollectableGenerator


class TestCollectableGenerator(unittest.TestCase):
    def setUp(self):
        self.collectable_generator: CollectableGenerator = CollectableGenerator()

    def test_adjust(self) -> None:
        weights = [[0.1, 0.4], [0.6, 0.7]]
        result = self.collectable_generator.adjust(weights)
        result_flat = [x for row in result for x in row]
        self.assertEqual(max(result_flat), 1)
        self.assertEqual(min(result_flat), 0)

    def test_layer(self) -> None:
        weights_1 = [
            [
                0.35,
                0.98,
                0.48,
                0.87,
                0.68,
                0.7,
                0.28,
                0.11,
                0.05,
                0.45,
                0.4,
                0.91,
                0.71,
                0.78,
            ],
            [
                0.62,
                0.99,
                0.89,
                0.51,
                0.54,
                0.78,
                0.58,
                0.16,
                0.46,
                0.76,
                0.59,
                0.76,
                0.39,
                0.24,
            ],
            [
                0.49,
                0.18,
                0.2,
                0.02,
                0.73,
                0.06,
                0.52,
                0.38,
                0.98,
                0.42,
                0.78,
                0.88,
                0.34,
                0.25,
            ],
            [
                0.06,
                0.12,
                0.61,
                0.68,
                0.27,
                0.46,
                0.02,
                0.73,
                0.08,
                0.84,
                0.46,
                0.51,
                0.45,
                0.4,
            ],
            [
                0.59,
                0.6,
                0.88,
                0.9,
                0.12,
                0.69,
                0.84,
                0.96,
                0.46,
                0.78,
                0.7,
                0.76,
                0.81,
                0.46,
            ],
            [
                0.44,
                0.46,
                0.57,
                0.35,
                0.6,
                0.13,
                0.56,
                0.75,
                0.51,
                0.28,
                0.52,
                0.74,
                0.54,
                0.97,
            ],
            [
                0.32,
                0.99,
                0.2,
                0.54,
                0.02,
                0.27,
                0.46,
                0.35,
                0.74,
                0.47,
                0.51,
                0.99,
                0.82,
                0.52,
            ],
            [
                0.22,
                0.89,
                0.35,
                0.2,
                0.75,
                0.81,
                0.33,
                0.56,
                0.02,
                0.12,
                0.45,
                0.4,
                0.88,
                0.27,
            ],
            [
                0.2,
                0.77,
                0.87,
                0.44,
                0.67,
                0.12,
                0.19,
                0.22,
                0.47,
                0.44,
                0.13,
                0.39,
                0.32,
                0.98,
            ],
            [
                0.16,
                0.91,
                0.19,
                0.44,
                0.97,
                0.55,
                0.33,
                0.46,
                0.68,
                0.05,
                0.31,
                0.92,
                0.83,
                0.91,
            ],
            [
                0.16,
                0.24,
                0.36,
                0.64,
                0.52,
                0.02,
                0.57,
                0.03,
                0.14,
                0.22,
                0.34,
                0.4,
                0.87,
                0.72,
            ],
            [
                0.94,
                0.65,
                0.38,
                0.51,
                0.77,
                0.77,
                0.75,
                0.24,
                0.33,
                0.4,
                0.82,
                0.39,
                0.29,
                0.55,
            ],
            [
                0.39,
                0.47,
                0.52,
                0.61,
                0.28,
                0.44,
                0.81,
                0.54,
                0.3,
                0.91,
                0.09,
                0.23,
                0.59,
                0.07,
            ],
            [
                0.54,
                0.63,
                0.15,
                0.4,
                0.3,
                0.05,
                0.51,
                0.18,
                0.98,
                0.99,
                0.5,
                0.16,
                0.16,
                0.45,
            ],
        ]
        weights_2 = [
            [
                0.36,
                0.42,
                0.58,
                0.63,
                0.39,
                0.04,
                0.47,
                0.77,
                0.42,
                0.39,
                0.23,
                0.71,
                0.35,
                0.17,
            ],
            [
                0.06,
                0.75,
                0.78,
                0.16,
                0.13,
                0.92,
                0.23,
                0.22,
                0.18,
                0.65,
                0.37,
                0.73,
                0.19,
                0.33,
            ],
            [
                0.77,
                0.06,
                0.8,
                0.51,
                0.07,
                0.94,
                0.34,
                0.87,
                0.55,
                0.92,
                0.98,
                0.21,
                0.03,
                0.42,
            ],
            [
                0.27,
                0.26,
                0.99,
                0.67,
                0.3,
                0.28,
                0.7,
                0.5,
                0.68,
                0.07,
                0.5,
                0.7,
                0.11,
                0.6,
            ],
            [
                0.02,
                0.34,
                0.2,
                0.16,
                0.67,
                0.13,
                0.59,
                0.25,
                0.52,
                0.67,
                0.12,
                0.15,
                0.24,
                0.17,
            ],
            [
                0.25,
                0.94,
                0.81,
                0.38,
                0.23,
                0.43,
                0.37,
                0.13,
                0.11,
                0.18,
                0.66,
                0.68,
                0.88,
                0.78,
            ],
            [
                0.72,
                0.43,
                0.32,
                0.35,
                0.73,
                0.09,
                0.13,
                0.46,
                0.81,
                0.67,
                0.14,
                0.89,
                0.96,
                0.85,
            ],
            [
                0.66,
                0.36,
                0.14,
                0.41,
                0.8,
                0.53,
                0.03,
                0.06,
                0.23,
                0.53,
                0.21,
                0.81,
                0.26,
                0.89,
            ],
            [
                0.26,
                0.61,
                0.7,
                0.07,
                0.08,
                0.99,
                0.65,
                0.44,
                0.37,
                0.36,
                0.46,
                0.31,
                0.78,
                0.01,
            ],
            [
                0.8,
                0.65,
                0.68,
                0.15,
                0.58,
                0.24,
                0.9,
                0.18,
                0.33,
                0.43,
                0.03,
                0.19,
                0.55,
                0.74,
            ],
            [
                0.46,
                0.25,
                0.66,
                0.53,
                0.07,
                0.33,
                0.01,
                0.04,
                0.87,
                0.92,
                0.69,
                0.75,
                0.66,
                0.31,
            ],
            [
                0.17,
                1.0,
                0.76,
                0.48,
                0.83,
                0.77,
                0.51,
                0.49,
                0.97,
                0.02,
                0.51,
                0.17,
                0.71,
                0.97,
            ],
            [
                0.38,
                0.33,
                0.66,
                0.62,
                0.1,
                0.16,
                0.65,
                0.63,
                0.72,
                0.22,
                0.51,
                0.53,
                0.6,
                0.31,
            ],
            [
                0.75,
                0.12,
                0.37,
                0.73,
                0.91,
                0.47,
                0.75,
                0.5,
                0.27,
                0.72,
                0.65,
                0.17,
                0.15,
                0.22,
            ],
        ]
        expected_result = [
            [
                0.126,
                0.41159999999999997,
                0.2784,
                0.5481,
                0.26520000000000005,
                0.027999999999999997,
                0.1316,
                0.0847,
                0.021,
                0.17550000000000002,
                0.09200000000000001,
                0.6461,
                0.24849999999999997,
                0.13260000000000002,
            ],
            [
                0.0372,
                0.7424999999999999,
                0.6942,
                0.0816,
                0.07020000000000001,
                0.7176,
                0.1334,
                0.0352,
                0.0828,
                0.49400000000000005,
                0.2183,
                0.5548,
                0.0741,
                0.0792,
            ],
            [
                0.3773,
                0.010799999999999999,
                0.16000000000000003,
                0.0102,
                0.051100000000000007,
                0.05639999999999999,
                0.1768,
                0.3306,
                0.539,
                0.3864,
                0.7644,
                0.1848,
                0.0102,
                0.105,
            ],
            [
                0.0162,
                0.0312,
                0.6039,
                0.45560000000000006,
                0.081,
                0.12880000000000003,
                0.013999999999999999,
                0.365,
                0.054400000000000004,
                0.058800000000000005,
                0.23,
                0.357,
                0.0495,
                0.24,
            ],
            [
                0.0118,
                0.20400000000000001,
                0.17600000000000002,
                0.14400000000000002,
                0.0804,
                0.0897,
                0.49559999999999993,
                0.24,
                0.23920000000000002,
                0.5226000000000001,
                0.08399999999999999,
                0.11399999999999999,
                0.19440000000000002,
                0.0782,
            ],
            [
                0.11,
                0.4324,
                0.4617,
                0.13299999999999998,
                0.138,
                0.0559,
                0.20720000000000002,
                0.0975,
                0.056100000000000004,
                0.0504,
                0.3432,
                0.5032,
                0.4752,
                0.7566,
            ],
            [
                0.2304,
                0.42569999999999997,
                0.064,
                0.189,
                0.0146,
                0.024300000000000002,
                0.059800000000000006,
                0.161,
                0.5994,
                0.3149,
                0.0714,
                0.8811,
                0.7871999999999999,
                0.442,
            ],
            [
                0.1452,
                0.3204,
                0.049,
                0.082,
                0.6000000000000001,
                0.42930000000000007,
                0.0099,
                0.033600000000000005,
                0.0046,
                0.0636,
                0.0945,
                0.32400000000000007,
                0.2288,
                0.2403,
            ],
            [
                0.052000000000000005,
                0.4697,
                0.609,
                0.030800000000000004,
                0.0536,
                0.11879999999999999,
                0.12350000000000001,
                0.0968,
                0.1739,
                0.15839999999999999,
                0.059800000000000006,
                0.12090000000000001,
                0.24960000000000002,
                0.0098,
            ],
            [
                0.128,
                0.5915,
                0.1292,
                0.066,
                0.5626,
                0.132,
                0.29700000000000004,
                0.0828,
                0.22440000000000002,
                0.021500000000000002,
                0.0093,
                0.1748,
                0.4565,
                0.6734,
            ],
            [
                0.0736,
                0.06,
                0.2376,
                0.3392,
                0.0364,
                0.006600000000000001,
                0.005699999999999999,
                0.0012,
                0.1218,
                0.2024,
                0.2346,
                0.30000000000000004,
                0.5742,
                0.22319999999999998,
            ],
            [
                0.1598,
                0.65,
                0.2888,
                0.2448,
                0.6391,
                0.5929,
                0.3825,
                0.1176,
                0.3201,
                0.008,
                0.41819999999999996,
                0.06630000000000001,
                0.20589999999999997,
                0.5335,
            ],
            [
                0.1482,
                0.1551,
                0.3432,
                0.3782,
                0.028000000000000004,
                0.0704,
                0.5265000000000001,
                0.3402,
                0.216,
                0.20020000000000002,
                0.045899999999999996,
                0.12190000000000001,
                0.354,
                0.0217,
            ],
            [
                0.405,
                0.0756,
                0.0555,
                0.292,
                0.273,
                0.0235,
                0.3825,
                0.09,
                0.2646,
                0.7128,
                0.325,
                0.027200000000000002,
                0.024,
                0.099,
            ],
        ]
        result = self.collectable_generator.layer(weights_1, weights_2)
        self.assertEqual(result, expected_result)

    def test_map_threshold(self) -> None:
        weights = [[0.2, 0.4], [0.5, 0.3]]
        expected_result = [[False, True], [True, False]]
        result = self.collectable_generator.map_threshold(0.4, weights)
        self.assertEqual(result, expected_result)
